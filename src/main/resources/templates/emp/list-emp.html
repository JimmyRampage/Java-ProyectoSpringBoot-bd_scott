<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>List Employees</title>
    <!-- BootStrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <!-- FontAwesome -->
    <link
      href="https://use.fontawesome.com/releases/v7.1.0/css/all.css"
      rel="stylesheet"
    />
  </head>
  <body class="d-flex flex-column min-vh-100">
    <div th:replace="~{fragments/navbar :: navbar}"></div>

    <!-- HEADER -->
    <div
      th:replace="~{fragments/header :: header(title = 'Listado Empleados')}"
    ></div>

    <!-- Boton -->
    <div class="container my-2">
      <div class="row">
        <div class="col text-center">
          <a th:href="@{/emp/createEmp}" class="btn btn-primary"
            >Create New Emp</a
          >
        </div>
      </div>
    </div>

    <!-- Mensaje -->
    <div class="container mb-2">
      <div class="row">
        <h3
          th:if="${msg != null}"
          class="alert alert-success text-center"
          th:text="${msg}"
        ></h3>
      </div>
    </div>

    <div class="container">
      <div class="row my-2">
        <form
          th:action="@{/emp/list}"
          method="GET"
          class="row g-3 align-items-center justify-content-center"
        >
          <div class="col-auto">
            <select name="type" class="form-select">
              <option
                value="ename"
                th:selected="${tipoSeleccionado == 'ename'}"
              >
                Ename
              </option>
              <option
                value="job"
                th:selected="${tipoSeleccionado == 'job'}"
                >
                Job
              </option>
              <option
                value="sal"
                th:selected="${tipoSeleccionado == 'sal'}"
                >
                Salary Min
              </option>
              <option
                value="comm"
                th:selected="${tipoSeleccionado == 'comm'}"
                >
                Commission Min
              </option>
              <option
                value="deptno"
                th:selected="${tipoSeleccionado == 'deptno'}"
                >
                Department No.
              </option>
            </select>
          </div>
          <div class="col-auto">
            <input
              type="text"
              name="value"
              class="form-control"
              placeholder="keyword..."
              th:value="${valorBuscado}"
            />
          </div>
          <div class="col-auto">
            <button type="submit" class="btn btn-primary">Search</button>
            <a th:href="@{/emp/list}" class="btn btn-secondary">Clean</a>
          </div>
        </form>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <table class="table table-striped">
          <thead>
            <tr class="table-primary">
              <th>EMPNO</th>
              <th>ENAME</th>
              <th>JOB</th>
              <th>MGR</th>
              <th>SAL</th>
              <th>COMM</th>
              <th>DEPTNO</th>
              <th>HIREDATE</th>
              <th>ACTIONS</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="emp : ${empPage.content}">
              <td th:text="${emp.empno}"></td>
              <td th:text="${emp.ename}"></td>
              <td th:text="${emp.job}"></td>
              <!-- Ternario en caso de null -->
              <td
                th:text="${emp.manager != null ? emp.manager.empno : 'N/A'}"
              ></td>
              <td th:text="${emp.sal}"></td>
              <td th:text="${emp.comm != null ? emp.comm : '0.0'}"></td>
              <!-- Alternativa en caso de null -->
              <td
                th:text="${emp.deptno?.deptno + ' (' + emp.deptno?.dname + ')'}"
              ></td>
              <td
                th:text="${#temporals.format(emp.hiredate, 'dd/MM/yyyy')}"
              ></td>
              <td>
                <!-- Update -->
                <a
                  th:href="@{/emp/edit/{id} (id=${emp.empno})}"
                  class="text-warning"
                  ><i class="fa-regular fa-pen-to-square"></i
                ></a>
                <!-- Delete -->
                <a
                  th:href="@{/emp/delete/{id} (id=${emp.empno})}"
                  onclick="return confirm('Â¿Estas seguro?')"
                  class="text-danger"
                  ><i class="fa-solid fa-ban"></i
                ></a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Pageable -->
    <div th:replace="~{fragments/pageable :: pageable(${empPage}, '/emp/list')}"></div>

    <!-- Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>
    <!-- BootStrap -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
